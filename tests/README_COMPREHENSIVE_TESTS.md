# Comprehensive API Test Suite

## –û–ø–∏—Å–∞–Ω–∏–µ

–§–∞–π–ª `comprehensive_test_api.js` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö API endpoints –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Wayzer.

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5000
node tests/comprehensive_test_api.js
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### üîê Authentication Tests (12 —Ç–µ—Å—Ç–æ–≤)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ 3-—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Alice, Bob, Charlie)
- –¢–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ email, –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### üë§ User Profile Tests (13 —Ç–µ—Å—Ç–æ–≤)
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- –ü—É–±–ª–∏—á–Ω—ã–µ vs –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
- –¢–µ—Å—Ç—ã –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### üìä Static Data Tests (4 —Ç–µ—Å—Ç–∞)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–æ–µ–∑–¥–æ–∫
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤

### üß≠ Trip Tests (14 —Ç–µ—Å—Ç–æ–≤)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–µ–∑–¥–æ–∫ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –∏ –≥–æ—Ä–æ–¥—É
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- Edge cases –∏ error handling

### üé´ Trip Participation Tests (10 —Ç–µ—Å—Ç–æ–≤)
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—ã—Ö–æ–¥ –∏–∑ –ø–æ–µ–∑–¥–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### ‚≠ê Favorites Tests (8 —Ç–µ—Å—Ç–æ–≤)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- Error scenarios

### üó∫Ô∏è My Trips Tests (3 —Ç–µ—Å—Ç–∞)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–≤–æ–∏—Ö –ø–æ–µ–∑–¥–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üí¨ Messaging Tests (17 —Ç–µ—Å—Ç–æ–≤)

**–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
1. Bob –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ Alice
2. Alice –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `conversations` - –¥–æ–ª–∂–Ω–∞ —É–≤–∏–¥–µ—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (unreadCount > 0)
3. Bob –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `conversations` - —É –Ω–µ–≥–æ unreadCount = 0 –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞
4. Alice —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (GET `/api/messages2/:chatId`)
5. Alice —Å–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `conversations` - unreadCount –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å 0

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–≤–µ—Ç —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ —É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
1. Alice –æ—Ç–≤–µ—á–∞–µ—Ç Bob
2. Bob –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `conversations` - –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ –æ—Ç Alice

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
1. Alice –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥
2. Bob –ø—Ä–æ–≤–µ—Ä—è–µ—Ç conversations - —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
3. Bob –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/messages/mark-read?chatId=X`
4. –°—á–µ—Ç—á–∏–∫ –æ–±–Ω—É–ª—è–µ—Ç—Å—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Ç–æ–≤
1. Charlie —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —á–∞—Ç —Å Alice
2. Alice –≤–∏–¥–∏—Ç 2 —Ä–∞–∑–Ω—ã—Ö —á–∞—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—á–µ—Ç—á–∏–∫–∞–º–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

#### Error Cases
- –û—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
- –î–æ—Å—Ç—É–ø –∫ —á—É–∂–æ–º—É —á–∞—Ç—É (403)
- –ü–æ–ª—É—á–µ–Ω–∏–µ conversations –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
–ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ email-—ã (—Å timestamp) –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### 2. –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–¢–µ—Å—Ç—ã –≤—ã–≤–æ–¥—è—Ç debug-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:
```
Debug: Bob's chat unreadCount = 1
Debug: After reading, unreadCount = 0
```

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```
üìä TEST SUMMARY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Total tests:  81
‚úÖ Passed:    81 (100%)
‚ùå Failed:    0 (0%)
‚è≠Ô∏è  Skipped:   0
```

### 4. –ü–æ–Ω—è—Ç–Ω—ã–µ ID —Ç–µ—Å—Ç–æ–≤
–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ª–µ–≥–∫–æ–π –æ—Ç–ª–∞–¥–∫–∏:
- `[AUTH-001]`, `[AUTH-002]` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `[USER-001]`, `[USER-002]` - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- `[MSG-001]`, `[MSG-002]` - —Å–æ–æ–±—â–µ–Ω–∏—è
- `[TRIP-001]`, `[TRIP-002]` - –ø–æ–µ–∑–¥–∫–∏
- –∏ —Ç.–¥.

## –û—Ç–ª–∏—á–∏—è –æ—Ç test_api.js

| –ê—Å–ø–µ–∫—Ç | test_api.js | comprehensive_test_api.js |
|--------|-------------|---------------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ | ~40 | ~80+ |
| –¢–µ—Å—Ç—ã –æ—à–∏–±–æ–∫ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ | –û–±—à–∏—Ä–Ω—ã–µ |
| –¢–µ—Å—Ç—ã —á–∞—Ç–∞ | –ë–∞–∑–æ–≤—ã–µ | **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏** |
| –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | 2 | 3 |
| ID —Ç–µ—Å—Ç–æ–≤ | –ù–µ—Ç | –î–∞ (`[CATEGORY-NNN]`) |
| Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –î–µ—Ç–∞–ª—å–Ω–∞—è |
| Edge cases | –ú–∞–ª–æ | –ú–Ω–æ–≥–æ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞ | –ë–∞–∑–æ–≤–∞—è | JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- WebSocket —Ç–µ—Å—Ç—ã –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã (—Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —á–∏—Å—Ç–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
